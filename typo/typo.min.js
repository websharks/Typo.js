var Typo;(function(){Typo=function(k,l,n,c){c=c||{};this.dictionary=null;this.rules={};this.dictionaryTable={};this.compoundRules=[];this.compoundRuleCodes={};this.replacementTable=[];this.flags=c.flags||{};this.memoized={};this.loaded=false;var o=this;var p;var e,d,h,g;if(k){o.dictionary=k;if(l&&n){b()}else{if(typeof window!=="undefined"&&"chrome" in window&&"extension" in window.chrome&&"getURL" in window.chrome.extension){if(c.dictionaryPath){p=c.dictionaryPath}else{p="typo/dictionaries"}if(!l){m(chrome.extension.getURL(p+"/"+k+"/"+k+".aff"),f)}if(!n){m(chrome.extension.getURL(p+"/"+k+"/"+k+".dic"),a)}}else{if(c.dictionaryPath){p=c.dictionaryPath}else{if(typeof __dirname!=="undefined"){p=__dirname+"/dictionaries"}else{p="./dictionaries"}}if(!l){m(p+"/"+k+"/"+k+".aff",f)}if(!n){m(p+"/"+k+"/"+k+".dic",a)}}}}function m(q,i){var j=o._readFile(q,null,c.asyncLoad);if(c.asyncLoad){j.then(function(r){i(r)})}else{i(j)}}function f(i){l=i;if(n){b()}}function a(i){n=i;if(l){b()}}function b(){o.rules=o._parseAFF(l);o.compoundRuleCodes={};for(e=0,h=o.compoundRules.length;e<h;e++){var r=o.compoundRules[e];for(d=0,g=r.length;d<g;d++){o.compoundRuleCodes[r[d]]=[]}}if("ONLYINCOMPOUND" in o.flags){o.compoundRuleCodes[o.flags.ONLYINCOMPOUND]=[]}o.dictionaryTable=o._parseDIC(n);for(e in o.compoundRuleCodes){if(o.compoundRuleCodes[e].length===0){delete o.compoundRuleCodes[e]}}for(e=0,h=o.compoundRules.length;e<h;e++){var i=o.compoundRules[e];var j="";for(d=0,g=i.length;d<g;d++){var q=i[d];if(q in o.compoundRuleCodes){j+="("+o.compoundRuleCodes[q].join("|")+")"}else{j+=q}}o.compoundRules[e]=new RegExp(j,"i")}o.loaded=true;if(c.asyncLoad&&c.loadedCallback){c.loadedCallback(o)}}return this};Typo.prototype={load:function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}return this},_readFile:function(k,b,c){b=b||"utf8";if(typeof XMLHttpRequest!=="undefined"){var j;var i=new XMLHttpRequest();i.open("GET",k,c);if(c){j=new Promise(function(l,e){i.onload=function(){if(i.status===200){l(i.responseText)}else{e(i.statusText)}};i.onerror=function(){e(i.statusText)}})}if(i.overrideMimeType){i.overrideMimeType("text/plain; charset="+b)}i.send(null);return c?j:i.responseText}else{if(typeof require!=="undefined"){var g=require("fs");try{if(g.existsSync(k)){var f=g.statSync(k);var a=g.openSync(k,"r");var d=new Buffer(f.size);g.readSync(a,d,0,d.length,null);return d.toString(b,0,d.length)}else{console.log("Path "+k+" does not exist.")}}catch(h){console.log(h);return""}}}},_parseAFF:function(x){var h={};var k,u,g,a;var s,r,v,e;x=this._removeAffixComments(x);var b=x.split("\n");for(s=0,v=b.length;s<v;s++){k=b[s];var p=k.split(/\s+/);var t=p[0];if(t=="PFX"||t=="SFX"){var q=p[1];var f=p[2];g=parseInt(p[3],10);var n=[];for(r=s+1,e=s+1+g;r<e;r++){u=b[r];a=u.split(/\s+/);var l=a[2];var o=a[3].split("/");var d=o[0];if(d==="0"){d=""}var m=this.parseRuleCodes(o[1]);var w=a[4];var c={};c.add=d;if(m.length>0){c.continuationClasses=m}if(w!=="."){if(t==="SFX"){c.match=new RegExp(w+"$")}else{c.match=new RegExp("^"+w)}}if(l!="0"){if(t==="SFX"){c.remove=new RegExp(l+"$")}else{c.remove=l}}n.push(c)}h[q]={type:t,combineable:(f=="Y"),entries:n};s+=g}else{if(t==="COMPOUNDRULE"){g=parseInt(p[1],10);for(r=s+1,e=s+1+g;r<e;r++){k=b[r];a=k.split(/\s+/);this.compoundRules.push(a[1])}s+=g}else{if(t==="REP"){a=k.split(/\s+/);if(a.length===3){this.replacementTable.push([a[1],a[2]])}}else{this.flags[t]=p[1]}}}}return h},_removeAffixComments:function(a){a=a.replace(/^\s*#.*$/mg,"");a=a.replace(/^\s\s*/m,"").replace(/\s\s*$/m,"");a=a.replace(/\n{2,}/g,"\n");a=a.replace(/^\s\s*/,"").replace(/\s\s*$/,"");return a},_parseDIC:function(B){B=this._removeDicComments(B);var c=B.split("\n");var d={};function t(i,j){if(!d.hasOwnProperty(i)){d[i]=null}if(j.length>0){if(d[i]===null){d[i]=[]}d[i].push(j)}}for(var w=1,A=c.length;w<A;w++){var o=c[w];var s=o.split("/",2);var y=s[0];if(s.length>1){var z=this.parseRuleCodes(s[1]);if(!("NEEDAFFIX" in this.flags)||z.indexOf(this.flags.NEEDAFFIX)==-1){t(y,z)}for(var v=0,f=z.length;v<f;v++){var a=z[v];var h=this.rules[a];if(h){var l=this._applyRule(y,h);for(var p=0,x=l.length;p<x;p++){var g=l[p];t(g,[]);if(h.combineable){for(var u=v+1;u<f;u++){var e=z[u];var n=this.rules[e];if(n){if(n.combineable&&(h.type!=n.type)){var r=this._applyRule(g,n);for(var q=0,m=r.length;q<m;q++){var b=r[q];t(b,[])}}}}}}}if(a in this.compoundRuleCodes){this.compoundRuleCodes[a].push(y)}}}else{t(y.trim(),[])}}return d},_removeDicComments:function(a){a=a.replace(/^\t.*$/mg,"");return a},parseRuleCodes:function(d){if(!d){return[]}else{if(!("FLAG" in this.flags)){return d.split("")}else{if(this.flags.FLAG==="long"){var b=[];for(var c=0,a=d.length;c<a;c+=2){b.push(d.substr(c,2))}return b}else{if(this.flags.FLAG==="num"){return d.split(",")}}}}},_applyRule:function(a,g){var d=g.entries;var m=[];for(var c=0,h=d.length;c<h;c++){var k=d[c];if(!k.match||a.match(k.match)){var f=a;if(k.remove){f=f.replace(k.remove,"")}if(g.type==="SFX"){f=f+k.add}else{f=k.add+f}m.push(f);if("continuationClasses" in k){for(var b=0,e=k.continuationClasses.length;b<e;b++){var l=this.rules[k.continuationClasses[b]];if(l){m=m.concat(this._applyRule(f,l))}}}}}return m},check:function(b){if(!this.loaded){throw"Dictionary not loaded."}var a=b.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(a)){return true}if(a.toUpperCase()===a){var c=a[0]+a.substring(1).toLowerCase();if(this.hasFlag(c,"KEEPCASE")){return false}if(this.checkExact(c)){return true}}var d=a.toLowerCase();if(d!==a){if(this.hasFlag(d,"KEEPCASE")){return false}if(this.checkExact(d)){return true}}return false},checkExact:function(d){if(!this.loaded){throw"Dictionary not loaded."}var c=this.dictionaryTable[d];var b,a;if(typeof c==="undefined"){if("COMPOUNDMIN" in this.flags&&d.length>=this.flags.COMPOUNDMIN){for(b=0,a=this.compoundRules.length;b<a;b++){if(d.match(this.compoundRules[b])){return true}}}}else{if(c===null){return true}else{if(typeof c==="object"){for(b=0,a=c.length;b<a;b++){if(!this.hasFlag(d,"ONLYINCOMPOUND",c[b])){return true}}}}}return false},hasFlag:function(b,a,c){if(!this.loaded){throw"Dictionary not loaded."}if(a in this.flags){if(typeof c==="undefined"){c=Array.prototype.concat.apply([],this.dictionaryTable[b])}if(c&&c.indexOf(this.flags[a])!==-1){return true}}return false},alphabet:"",suggest:function(a,b){if(!this.loaded){throw"Dictionary not loaded."}b=b||5;if(this.memoized.hasOwnProperty(a)){var h=this.memoized[a]["limit"];if(b<=h||this.memoized[a]["suggestions"].length<h){return this.memoized[a]["suggestions"].slice(0,b)}}if(this.check(a)){return[]}for(var c=0,g=this.replacementTable.length;c<g;c++){var f=this.replacementTable[c];if(a.indexOf(f[0])!==-1){var d=a.replace(f[0],f[1]);if(this.check(d)){return[d]}}}var k=this;k.alphabet="abcdefghijklmnopqrstuvwxyz";function l(t){var n=[];var v,q,p,o,u,r;for(v=0,o=t.length;v<o;v++){var m=t[v];for(q=0,u=m.length+1;q<u;q++){var w=[m.substring(0,q),m.substring(q)];if(w[1]){n.push(w[0]+w[1].substring(1))}if(w[1].length>1&&w[1][1]!==w[1][0]){n.push(w[0]+w[1][1]+w[1][0]+w[1].substring(2))}if(w[1]){for(p=0,r=k.alphabet.length;p<r;p++){if(k.alphabet[p]!=w[1].substring(0,1)){n.push(w[0]+k.alphabet[p]+w[1].substring(1))}}}if(w[1]){for(p=0,r=k.alphabet.length;p<r;p++){n.push(w[0]+k.alphabet[p]+w[1])}}}}return n}function j(o){var p=[];for(var n=0,m=o.length;n<m;n++){if(k.check(o[n])){p.push(o[n])}}return p}function e(p){var n=l([p]);var w=l(n);var o=j(n.concat(w));var r,t;var s={};for(r=0,t=o.length;r<t;r++){if(!(o[r] in s)){s[o[r]]=1}else{s[o[r]]+=1}}var u=[];for(r in s){if(s.hasOwnProperty(r)){u.push([r,s[r]])}}function v(x,i){if(x[1]<i[1]){return -1}return 1}u.sort(v).reverse();var q=[];var m="lowercase";if(p.toUpperCase()===p){m="uppercase"}else{if(p.substr(0,1).toUpperCase()+p.substr(1).toLowerCase()===p){m="capitalized"}}for(r=0,t=Math.min(b,u.length);r<t;r++){if("uppercase"===m){u[r][0]=u[r][0].toUpperCase()}else{if("capitalized"===m){u[r][0]=u[r][0].substr(0,1).toUpperCase()+u[r][0].substr(1)}}if(!k.hasFlag(u[r][0],"NOSUGGEST")){q.push(u[r][0])}}return q}this.memoized[a]={suggestions:e(a),limit:b};return this.memoized[a]["suggestions"]}}})();if(typeof module!=="undefined"){module.exports=Typo};